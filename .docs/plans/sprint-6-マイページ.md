# Sprint 6: マイページ + 管理画面

**状態**: ✅ 完了
**目標**: ユーザー/管理者向け完全な運用機能

---

## タスク一覧

### 6.1 マイページUI (/mypage)
- [x] タブ構成 (動画/予約/決済)
- [x] レスポンシブレイアウト
- [x] shadcn/ui: Sheet (モバイルメニュー)

### 6.2 動画一覧タブ
- [x] 動画カード表示
  - サムネイル / ステータス / 作成日
- [x] ダウンロード機能
- [x] 削除機能 (条件チェック含む)
  - canDeleteVideo API
  - 予約紐付き動画は削除不可
- [x] 投影予約ボタン (動画選択 → /reservations)

### 6.3 予約管理タブ
- [x] 予約一覧表示
  - 投影日 / スロット / ステータス
- [x] キャンセル機能 (48時間前まで)
  - cancelReservation API
  - 返金処理
- [x] キャンセル期限の表示

### 6.4 決済履歴タブ
- [x] 決済履歴一覧
- [x] ステータス表示 (succeeded/refunded/failed)
- [ ] 領収書リンク (Stripe) - 準備中

---

## 管理画面 (/admin)

### 6.5 管理画面レイアウト
- [x] サイドバーナビゲーション
- [x] Admin認証チェック (middleware)
- [x] shadcn/ui: Sidebar, Table, DropdownMenu

### 6.6 テンプレート管理
- [x] テンプレート一覧 (Table)
- [x] テンプレート作成 (Dialog)
- [x] テンプレート編集 (Dialog)
- [x] テンプレート削除 (確認付き)
- [x] カテゴリ別フィルター (背景/窓/車輪)

### 6.7 予約・投影管理
- [x] 予約一覧 (日付/スロット/ユーザー/ステータス)
- [x] フィルター (日付範囲/ステータス)
- [x] 投影完了マーク (confirmed → completed)
- [x] 強制キャンセル (返金処理含む)

### 6.8 投影スケジュール管理
- [x] スケジュール一覧 (Calendar 表示)
- [x] スケジュール追加 (投影可能日登録)
- [x] スケジュール削除 (予約なしの場合のみ)

### 6.9 監査ログ
- [x] 操作ログテーブル追加 (admin_audit_logs)
- [x] 記録対象:
  - 予約変更/キャンセル
  - 返金処理
  - テンプレート変更
  - スケジュール変更
- [x] ログ一覧表示 (Admin)

---

## 完了条件 (Definition of Done)

- [x] ユーザーが自分の動画/予約/決済を管理できる
- [x] 48時間ルールが正しく適用される
- [x] 管理者がテンプレート/予約/スケジュールを操作できる
- [x] 重要な操作が監査ログに記録される
- [x] 権限チェックが全APIで実装されている

---

## 参照仕様
- [画面仕様 - MyPage](.docs/spec/screens.md#mypage-mypage)
- [画面仕様 - Admin](.docs/spec/screens.md#admin-admin)
- [ビジネスロジック - 動画削除可能条件](.docs/spec/business-logic.md#動画削除可能条件)
